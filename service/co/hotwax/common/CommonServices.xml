<?xml version="1.0" encoding="UTF-8"?>
<services xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="https://moqui.org/xsd/service-definition-3.xsd">

    <service verb="check" noun="OmsConnection">
        <actions>
            <script>
                omsBaseUrl = co.hotwax.util.MaargUtil.getOmsInstanceUrl(ec.ecfi);
            </script>
            <if condition="!omsBaseUrl">
                <entity-find-one entity-name="moqui.service.message.SystemMessageRemote" value-field="omsSystemMessageRemote">
                    <field-map field-name="systemMessageRemoteId" value="HC_OMS_CONFIG"/>
                </entity-find-one>
                <if condition="!omsSystemMessageRemote || !omsSystemMessageRemote.remotePublicKey">
                    <return error="true" message="OMS token not configured." />
                </if>
            </if>
        </actions>
    </service>
</services>